!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):(e="undefined"!=typeof globalThis?globalThis:e||self).mapmostUE=o()}(this,(function(){"use strict";function e(e,o){window.ue.interface[e]=function(e){o&&o(e)}}function o(e,o){window.ue4(e,o)}function t(e,o,t){window.ue4(e,o,t)}function a(e){alert(e)}function i(e){let o=0;for(let t=0;t<e.length;t++)null!=e.charAt(t).match(/[^\x00-\xff]/gi)?o+=2:o+=1;return o}function n(e){t("Camera",{module:"Camera",subModule:"Interaction",method:"getCameraParameters",data:{}},(function(o){e&&e({location:o.location,rotation:o.rotation})}))}return{init:function(){!function(e){let o=document.createElement("script");o.type="text/javascript";try{o.appendChild(document.createTextNode(e))}catch(t){o.text=e}document.body.appendChild(o)}('"object" != typeof ue && (ue = {}), uuidv4 = function () { return "10000000-1000-4000-8000-100000000000".replace(/[018]/g, function (t) { return (t ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> t / 4).toString(16) }) }, ue4 = function (r) { return "object" != typeof ue.interface || "function" != typeof ue.interface.broadcast ? (ue.interface = {}, function (t, e, n, o) { var u, i; "string" == typeof t && ("function" == typeof e && (o = n, n = e, e = null), u = [t, "", r(n, o)], void 0 !== e && (u[1] = e), i = encodeURIComponent(JSON.stringify(u)), "object" == typeof history && "function" == typeof history.pushState ? (history.pushState({}, "", "#" + i), history.pushState({}, "", "#" + encodeURIComponent("[]"))) : (document.location.hash = i, document.location.hash = encodeURIComponent("[]"))) }) : (i = ue.interface, ue.interface = {}, function (t, e, n, o) { var u; "string" == typeof t && ("function" == typeof e && (o = n, n = e, e = null), u = r(n, o), void 0 !== e ? i.broadcast(t, JSON.stringify(e), u) : i.broadcast(t, "", u)) }); var i }(function (t, e) { if ("function" != typeof t) return ""; var n = uuidv4(); return ue.interface[n] = t, setTimeout(function () { delete ue.interface[n] }, 1e3 * Math.max(1, parseInt(e) || 0)), n });'),ue.interface.onFlyToEndListener=function(e){},ue.interface.onMousePickListener=function(e){},ue.interface.onMapStatusChangeListener=function(e){},ue.interface.onPOIClickListener=function(e){},ue.interface.onPOIExpandCollapseListener=function(e){},ue.interface.onMarkerClickListener=function(e){},ue.interface.onPipelineClickListener=function(e){},ue.interface.onRoamIntervalListener=function(e){},window.ue4("Tools",{module:"Tools",subModule:"Other",method:"getVersionName",data:{}},(function(e){console.log(`Mapmost for Unreal v${e.versionName} Copyright (c) 2022, 苏州工业园区测绘地理信息有限公司`)}))},allowIdle:function(e){o("Camera",{module:"Camera",subModule:"Interaction",method:"allowIdle",data:{isAllow:e||!1}})},frozenMap:function(e){o("Camera",{module:"Camera",subModule:"Interaction",method:"isFrozen",data:{isFrozen:e||!1}})},getCameraParameters:n,setInteractionMode:function(e){o("Camera",{module:"Camera",subModule:"Interaction",method:"setInteractionMode",data:{mode:e||"Explorer"}})},allowDecelerationStop:function(e){o("Camera",{module:"Camera",subModule:"Interaction",method:"allowDecelerationStop",data:{isAllow:e||!1}})},flyTo:function(e,t){let{location:a,rotation:i,time:l}=e;n((function(e){var n,d;n="onFlyToEndListener",d=t,window.ue.interface[n]=function(e){d&&d(e),window.ue.interface[n]=function(){}},o("Camera",{module:"Camera",subModule:"Control",method:"flyTo",data:{location:a||e.location,rotation:i||e.rotation,time:l||1.3}})}))},interruptFlyTo:function(){o("Camera",{module:"Camera",subModule:"Control",method:"interruptFlyTo",data:{}})},moveForward:function(e){o("Camera",{module:"Camera",subModule:"Control",method:"moveForward",data:{distance:e||0}})},moveRight:function(e){o("Camera",{module:"Camera",subModule:"Control",method:"moveRight",data:{distance:e||0}})},zoom:function(e){o("Camera",{module:"Camera",subModule:"Control",method:"zoom",data:{distance:e||0}})},turnRight:function(e){o("Camera",{module:"Camera",subModule:"Control",method:"turnRight",data:{degree:e||0}})},turnUp:function(e){o("Camera",{module:"Camera",subModule:"Control",method:"turnUp",data:{degree:e||0}})},setOnMousePickListener:function(t){e("onMousePickListener",(function(e){t&&t(e)})),o("Camera",{module:"Camera",subModule:"Event",method:"setOnMousePickListener",data:{}})},removeOnMousePickListener:function(){o("Camera",{module:"Camera",subModule:"Event",method:"removeOnMousePickListener",data:{}}),e("onMousePickListener")},setOnMapStatusChangeListener:function(t){e("onMapStatusChangeListener",(function(e){t&&t(e)})),o("Camera",{module:"Camera",subModule:"Event",method:"setOnMapStatusChangeListener",data:{}})},removeOnMapStateChangeListener:function(t){o("Camera",{module:"Camera",subModule:"Event",method:"removeOnMapStateChangeListener",data:{}}),e("onMapStatusChangeListener",(function(e){t&&t(e)}))},set3DTilesVisibility:function(e){o("Layer",{module:"Layer",subModule:"3DTiles",method:"set3DTilesVisibility",data:{isVisible:e||!1}})},setTMSAnd3DTilesOpacity:function(e){o("Layer",e>=1?{module:"Layer",subModule:"3DTiles",method:"restoreTMSAnd3DTilesOpacity",data:{}}:{module:"Layer",subModule:"3DTiles",method:"setTMSAnd3DTilesOpacity",data:{opacity:e<0?0:e}})},setTMSVisibility:function(e){o("Layer",{module:"Layer",subModule:"TMS",method:"setTMSVisibility",data:{isVisible:e||!1}})},set3DTilesHeightOffset:function(e){o("Layer",{module:"Layer",subModule:"3DTiles",method:"set3DTilesHeightOffset",data:{deltaHeight:100*(e||0)}})},addPOIs:function(e,t,n){if(e&&t){let a,l,d,u,r=[];if(n){let{mainStyle:e,tagStyle:o}=n;{let{property:o,style:t}=e||{};a=o,l=t}{let{property:e,style:t}=o||{};d=e,u=t}}t.features.forEach((e=>{let o=e.properties,{id:t,name:n,detailUrl:s,height:c,heading:m,pitch:f,distance:h,time:y,enableAutoFlyTo:p}=o,M={id:t||"",name:n||"",location:e.geometry.coordinates.concat(c),height:c||0,url:s||"",enableAutoFlyTo:void 0===p||p};if(void 0===m&&void 0===f&&void 0===h&&void 0===y||(M.focusSet={},m&&(M.focusSet.focusZ=m),f&&(M.focusSet.focusY=f),h&&(M.focusSet.focusDistance=100*h),y&&(M.focusSet.time=y||1)),d){let e=o[d];if(e)for(let o=0;o<u.length;o++)if(u[o].value===e){M.desc=e,M.labelSizeWidth=68,u[o].color&&(M.descBgColor=u[o].color||"#929292");break}}if(a){let e=o[a];if(e)for(let o=0;o<l.length;o++)if(l[o].value===e){let{color:e,iconImage:t,iconRotation:a,subIconImage:n,labelWidth:d,layout:u}=l[o];e&&(M.lineColor=e),t&&(M.iconUrl=t),n&&(M.subIconUrl=n),void 0!==a&&(M.icon_angle=a),M.labelSizeWidth=d||(M.labelSizeWidth||0)+(10*i(M.name)+(n?88:44)),u&&u.width&&(M.windowSizeWidth=u.width),u&&u.height&&(M.windowSizeHeight=u.height);break}}r.push(M)})),o("Layer",{module:"Layer",subModule:"POI",method:"addPOIs",data:{layerId:e,poidata:r}})}else a("addPOIListLayer输入参数无效，请检查！")},setPOIsVisibility:function(e,t){e?o("Layer",{module:"Layer",subModule:"POI",method:"setPOIsVisibility",data:{layerId:e,isVisible:t||!1}}):a("setPOIsVisibility未输入layerId")},removePOIs:function(e){e?o("Layer",{module:"Layer",subModule:"POI",method:"removePOIs",data:{layerId:e}}):a("removeLayer未输入layerId")},updatePOIs:function(e,t){const a={id:"id",name:"name",location:"location",color:"lineColor",labelWidth:"labelSizeWidth",tag:"desc",tagColor:"descBgColor",iconImage:"iconUrl",subIconImage:"subIconUrl"};o("Layer",{module:"Layer",subModule:"POI",method:"updatePOIs",data:{layerId:e,poiData:t.map((e=>{let o={};return Object.keys(e).forEach((t=>o[a[t]]=e[t])),o}))}})},hasPOIs:function(e,o){e?t("Layer",{module:"Layer",subModule:"POI",method:"hasLayer",data:{layerId:e}},(function(e){o&&o(e)})):o&&o(!1)},showPOIContent:function(e,t){e&&t?o("Layer",{module:"Layer",subModule:"POI",method:"showPOIContent",data:{layerId:e,poiId:t}}):a("showPOIContent参数缺失。")},hidePOIContent:function(e,t){e&&t?o("Layer",{module:"Layer",subModule:"POI",method:"hidePOIContent",data:{layerId:e,poiId:t}}):a("hidePOIContent参数缺失。")},highlightPOI:function(e,t,a){e&&t&&o("Layer",{module:"Layer",subModule:"POI",method:"highlightPOI",data:{layerId:e,poiId:t,color:a.color||"#3399ff"}})},unhighlightPOI:function(e,t){e&&t&&o("Layer",{module:"Layer",subModule:"POI",method:"unhighlight",data:{layerId:e,poiId:t}})},setOnPOIClickListener:function(o){e("onPOIClickListener",(function(e){o&&o(e)}))},removeOnPOIClickListener:function(){e("onPOIClickListener")},setOnPOIExpandCollapseListener:function(o){e("onPOIExpandCollapseListener",(function(e){o&&o(e)}))},removeOnPOIExpandCollapseListener:function(){e("onPOIExpandCollapseListener")},setDistanceOfPOIStatusChange:function(e){let{distanceShowAll:t,distanceShowLineOnly:a}=e;o("Layer",{module:"Layer",subModule:"POI",method:"setDistanceOfPOIStatusChange",data:{distanceShowAll:100*t,distanceShowLineOnly:100*a}})},addHeatmap:function(e,t){let a=0,i=999999,n=e.features.map((e=>{let{geometry:o,properties:t}=e,n=t.value||0;return a=Math.max(a,n),i=Math.min(i,n),{lng:o.coordinates[0],lat:o.coordinates[1],value:n}})),{radius:l,range:d,height:u,opacity:r,positionHeight:s}=t;a=d&&d[1]?d[1]:a,i=d&&d[0]?d[0]:i,o("Layer",{module:"Layer",subModule:"Heatmap",method:"addHeatmap",data:{heatmapData:n,minValue:i,maxValue:a,radius:l||20,height:u||1e3,opacity:r||.85,positionHeight:100*s||-1}})},removeHeatmap:function(){o("Layer",{module:"Layer",subModule:"Heatmap",method:"removeHeatmap",data:{}})},addMarker:function(e,t){let{name:a,type:i,location:n,iconImage:l,bgColor:d,enableAutoFlyTo:u,imageUrl:r,url:s,windowWidth:c,windowHeight:m,showIcon:f}=t,h={module:"Layer",subModule:"Point",method:"addMarker",data:{}};switch(i){case"window":h.data={id:e,type:"window",location:n,url:s,windowWidth:c||350,windowHeight:m||150,enableAutoFlyTo:void 0===u||u};break;case"classic":default:h.data={id:e,name:a,type:"classic",location:n,icon:l,isShowIcon:void 0===f||f,enableAutoFlyTo:void 0===u||u,labelBgColor:d||"#668866"},r&&(h.data.imageUrl=r)}o("Layer",h)},removeMarker:function(e){e&&o("Layer",{module:"Layer",subModule:"Point",method:"removeMarker",data:{id:e}})},setOnMarkerClickListener:function(o){e("onMarkerClickListener",(function(e){o&&o(e)}))},removeOnMarkerClickListener:function(){e("onMarkerClickListener")},addEffect:function(e,t){let{location:a,type:i,style:n}=t;n=n||{},"string"==typeof e?o("Layer",{module:"Layer",subModule:"Point",method:"addEffect",data:{id:e,location:a,type:i,style:{radiusOutside:n.radiusOutside||4e3,radiusInside:n.radiusInside||2e3}}}):console.log("addEffect参数错误")},removeEffect:function(e){o("Layer",{module:"Layer",subModule:"Point",method:"removeEffect",data:{id:e}})},addPolyline:function(e,t){if(e.features){let{color:a,type:i,arrowCount:n}=t||{};e.features.forEach((e=>{let t=[];t="MultiLineString"===e.geometry.type?e.geometry.coordinates[0]:e.geometry.coordinates;let l=t.map((o=>({location:o.concat(e.properties.height||0)})));o("Layer",{module:"Layer",subModule:"Line",method:"addPolyline",data:{type:i||"static",points:l,color:a||"#66cc66",arrowNumber:n||20}})}))}},removePolyline:function(){o("Layer",{module:"Layer",subModule:"Line",method:"removePolyline",data:{}})},addFlyLine:function(e){let{fromPoint:t,toPoint:a}=e;o("Layer",{module:"Layer",subModule:"Line",method:"addFlyLine",data:{fromPoint:t,toPoint:a}})},removeFlyLine:function(e){o("Layer",{module:"Layer",subModule:"Line",method:"removeFlyLine",data:{}})},addPolygon:function(e,t,a){if(t.features){let{color:i}=a||{},n=t.features[0],l=[];l="MultiPolygon"===n.geometry.type?n.geometry.coordinates[0]:n.geometry.coordinates;let d=[],u=[],r=0;for(let e=0;e<l.length;e++){e>0&&d.push({index:r});let o=l[e],t=o.map((e=>({lng:e[0],lat:e[1]})));u=u.concat(t),r+=o.length}o("Layer",{module:"Layer",subModule:"Fill",method:"addPolyGon",data:{id:e,color:i||"#291fba",height:n.properties.height||0,coordinates:u,holeIndices:d}})}},removePolygon:function(e){o("Layer",{module:"Layer",subModule:"Fill",method:"removePolyGon",data:{id:e}})},updatePolygon:function(e,t){let{color:a}=t||{};e&&a?o("Layer",{module:"Layer",subModule:"Fill",method:"updatePolyGon",data:{id:e,color:a}}):console.log("updatePolygon参数缺失请检查")},addFencing:function(e,t,a){if(t.features){let{extrudeHeight:i,extrudeColor:n,groundColor:l}=a||{},d=t.features[0],u=[];u="MultiPolygon"===d.geometry.type?d.geometry.coordinates[0]:d.geometry.coordinates;let r=[],s=[],c=0;for(let e=0;e<u.length;e++){e>0&&r.push({index:c-1});let o=u[e],t=o.map((e=>({lng:e[0],lat:e[1]})));s=s.concat(t),c+=o.length}o("Layer",{module:"Layer",subModule:"FillExtrusion",method:"addFencing",data:{id:e,height:d.properties.height||0,extrudeHeight:i||0,extrudeColor:n||"#291fba",groundColor:l||"#66b4cc",coordinates:s,holeIndices:r}})}},removeFencing:function(e){o("Layer",{module:"Layer",subModule:"FillExtrusion",method:"removeFencing",data:{id:e}})},updateFencing:function(e,t){e?o("Layer",{module:"Layer",subModule:"FillExtrusion",method:"updateFencing",data:{id:e,...t||{}}}):console.log("updateFencing缺少id")},addTexts:function(e,t){const{height:a}=t||{};o("Layer",{module:"Layer",subModule:"Text",method:"addTexts",data:{textData:e.features,height:a||1}})},removeTexts:function(){o("Layer",{module:"Layer",subModule:"Text",method:"removeTexts",data:{}})},setTextAvoidance:function(e){o("Layer",{module:"Layer",subModule:"Text",method:"setTextAvoidance",data:{canAvoid:void 0===e||e}})},addModel:function(e,t){let{type:a,location:i,rotation:n}=t;"string"==typeof e?o("Layer",{module:"Layer",subModule:"Model",method:"addModel",data:{id:e,type:a,location:i,rotation:n}}):console.log("请检查参数，缺少必要值！")},removeModel:function(e){o("Layer",{module:"Layer",subModule:"Model",method:"removeModel",data:{id:e}})},updateModel:function(e,t){let{location:a,rotation:i}=t;o("Layer",{module:"Layer",subModule:"Model",method:"updateModel",data:{id:e,location:a,rotation:i}})},addVideoFusion:function(e){let{id:t,cameraPosition:a,fov:i,cameraRotation:n,url:l,videoSize:d,far:u,opacity:r}=e;o("SpatialAnalysis",{module:"SpatialAnalysis",subModule:"VideoFusion",method:"addVideoFusion",data:{id:t||"videoProjectorTest",cameraPosition:a,cameraRotation:n,url:l,videoSize:d,far:u,fov:i,opacity:r}})},removeVideoFusion:function(e){o("SpatialAnalysis",{module:"SpatialAnalysis",subModule:"VideoFusion",method:"removeVideoFusion",data:{id:e||"videoProjectorTest"}})},startMeasureDistanceTriangulation:function(){o("SpatialAnalysis",{module:"SpatialAnalysis",subModule:"Measure",method:"startMeasureDistanceTriangulation",data:{}})},stopMeasureDistanceTriangulation:function(){o("SpatialAnalysis",{module:"SpatialAnalysis",subModule:"Measure",method:"stopMeasureDistanceTriangulation",data:{}})},startMeasureAreaContinuation:function(){o("SpatialAnalysis",{module:"SpatialAnalysis",subModule:"Measure",method:"startMeasureAreaContinuation",data:{}})},stopMeasureAreaContinuation:function(){o("SpatialAnalysis",{module:"SpatialAnalysis",subModule:"Measure",method:"stopMeasureAreaContinuation",data:{}})},startMeasureAreaProjection:function(){o("SpatialAnalysis",{module:"SpatialAnalysis",subModule:"Measure",method:"startMeasureAreaProjection",data:{}})},stopMeasureAreaProjection:function(){o("SpatialAnalysis",{module:"SpatialAnalysis",subModule:"Measure",method:"stopMeasureAreaProjection",data:{}})},startClip:function(){o("SpatialAnalysis",{module:"SpatialAnalysis",subModule:"Clip",method:"startClip",data:{}})},stopClip:function(){o("SpatialAnalysis",{module:"SpatialAnalysis",subModule:"Clip",method:"stopClip",data:{}})},startMapRoam:function(t,a){t.length>1&&(e("onRoamIntervalListener",a||function(){}),o("Tools",{module:"Tools",subModule:"MapRoam",method:"startMapRoam",data:{mapRoamData:t.map(((e,o)=>{let{location:a,rotation:i,direction:n,time:l}=e;if(n&&o>0){let e=i[2]-t[o-1].rotation[2];switch(n){case"left":e>0&&(i[2]=i[2]-360);break;case"right":e<0&&(i[2]=i[2]+360)}}return{location:a,rotation:i,time:l}}))}}))},pauseMapRoam:function(){o("Tools",{module:"Tools",subModule:"MapRoam",method:"pauseMapRoam",data:{}})},continueMapRoam:function(){o("Tools",{module:"Tools",subModule:"MapRoam",method:"continueMapRoam",data:{}})},stopMapRoam:function(){e("onRoamIntervalListener",(function(){})),o("Tools",{module:"Tools",subModule:"MapRoam",method:"stopMapRoam",data:{}})},startScreenSplit:function(){o("Tools",{module:"Tools",subModule:"ScreenSplit",method:"startScreenSplit",data:{}})},stopScreenSplit:function(){o("Tools",{module:"Tools",subModule:"ScreenSplit",method:"stopScreenSplit",data:{}})},quit:function(){o("Tools",{module:"Tools",subModule:"Other",method:"quit",data:{}})},setTimeSliderVisibility:function(e){o("Tools",{module:"Tools",subModule:"TimeSlider",method:"setTimeSliderVisibility",data:{isVisible:e||!1}})},setTimeSliderLayout:function(e){if(e){let{marginBottom:t,marginLeft:a,marginRight:i}=e;o("Tools",{module:"Tools",subModule:"TimeSlider",method:"setTimeSliderLayout",data:{marginBottom:t||0,marginLeft:a||0,marginRight:i||0}})}},setCompassVisibility:function(e){o("Tools",{module:"Tools",subModule:"Compass",method:"setCompassVisibility",data:{isVisible:e}})},setCompassLayout:function(e){let{offsetX:t,offsetY:a}=e;o("Tools",{module:"Tools",subModule:"Compass",method:"setCompassLayout",data:{offsetX:t||0,offsetY:a||0}})},setOnPipelineClickListener:function(t){e("onPipelineClickListener",(function(e){t&&t(e)})),o("PipeLine",{module:"PipeLine",subModule:"Event",method:"setOnPipeClickListener",data:{}})},removeOnPipelineClickListener:function(){o("PipeLine",{module:"PipeLine",subModule:"Event",method:"removePipeClickListener",data:{}}),e("onPipelineClickListener",(function(e){}))},highlightPipeline:function(e){o("PipeLine",{module:"PipeLine",subModule:"VisualEffect",method:"highlightPipeline",data:e})},unhighlightPipeline:function(){o("PipeLine",{module:"PipeLine",subModule:"VisualEffect",method:"unhighlightPipeline",data:{}})},setPipelineLayerVisibility:function(e,t){o("PipeLine",{module:"PipeLine",subModule:"VisualEffect",method:"setPipelineLayerVisibility",data:{pipelineType:e,isVisible:t}})},getVersionName:function(e){t("Tools",{module:"Tools",subModule:"Other",method:"getVersionName",data:{}},(function(o){e&&e(o.versionName)}))}}}));
